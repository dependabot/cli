# Build the dummy Dockerfile
exec docker build -qt graph-updater .

# Run the graph command and create a smoke test
dependabot graph go_modules dependabot/cli -o out.yml --updater-image graph-updater

# assert the dummy is working
stderr 'bin/run arguments: fetch_files'
stderr 'bin/run arguments: update_graph'
stderr '"enable_dependency_submission_poc":true'

# Verify the smoke test can run the graph command
dependabot test -f out.yml --updater-image graph-updater

stderr 'bin/run arguments: fetch_files'
stderr 'bin/run arguments: update_graph'

exec docker rmi -f graph-updater

-- Dockerfile --
FROM ubuntu:22.04

RUN useradd dependabot

COPY --chown=dependabot --chmod=755 update-ca-certificates /usr/bin/update-ca-certificates
COPY --chown=dependabot --chmod=755 run bin/run

-- update-ca-certificates --
#!/usr/bin/env bash

echo "Updated those certificates for ya"

-- run --
#!/usr/bin/env bash

echo "bin/run arguments: $@"
cat /home/dependabot/dependabot-updater/job.json; echo
